'use strict';

var indexOf = require('../index-of')

  , events;

require('../element#/event');
events = require('../main')._customEvents;

module.exports = function (base, name, filter) {
	var listeners, proxies;
	if (events.hasOwnProperty(name)) {
		throw new Error(name + " event already configured");
	}
	listeners = [];
	proxies = [];
	events[name] = {
		base: base,
		get: function (listener) {
			var index, proxy;
			if (typeof listener !== 'function') {
				throw new TypeError(listener + " is not a functon");
			}
			index = indexOf(listeners, listener);
			if (index !== -1) return proxies[index];
			proxy = function (e) {
				if (filter(e)) listener(e);
			};
			listeners.push(listener);
			proxies.push(proxy);
			return proxy;
		}
	};
};
