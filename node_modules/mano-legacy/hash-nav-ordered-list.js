// Handles ordered list of elements which should be toggled with url hash
// Hash indexes are generated automatically

'use strict';

var $       = require('./main')
  , hashNav = require('./hash-nav')

  , ContentList;

require('./element#/class');

ContentList = function (dom, prefix) {
	this.list = dom.getElementsByTagName('li');
	this.prefix = prefix;
};
ContentList.prototype.update = function () {
	var l = this.list.length, i;
	for (i = 1; i < l; ++i) {
		this.list[i].id = this.prefix + '-' + String(i + 1);
		this.list[i].setAttribute('data-hash-auto-scroll', '0');
	}
	if (l && $(this.list[0]).hasClass('active')) this.firstItemActive = this.list[0];
	if (location.hash.indexOf('#' + this.prefix) === 0) {
		if (this.firstItemActive) this.firstItemActive.removeClass('active');
		this.firstItemActive = null;
		return;
	}
	if (this.firstItemActive === this.list[0]) return;
	if (this.firstItemActive) this.firstItemActive.removeClass('active');
	this.firstItemActive = this.list[0] || null;
	if (this.firstItemActive) $(this.firstItemActive).addClass('active');
};

module.exports = $.hashNavOrderedList = function (ul, idPrefix) {
	var contentList = new ContentList($(ul), idPrefix);
	hashNav.on('update:before', function () { contentList.update(); });
	contentList.update();
	return contentList;
};
