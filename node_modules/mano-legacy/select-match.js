'use strict';

var $              = require('./main')
  , isInDocument   = require('./is-in-document')
  , proto          = require('./element#/main')
  , getUpdateByMap = require('./_get-update-by-map');

require('./element#/event');

module.exports = $.selectMatch = function (select, map) {
	var update, onChange, el;
	if (!select) throw new TypeError(select + " is not valid select reference");
	update = getUpdateByMap(map);

	proto.addEvent.call(document, 'change', onChange = function () {
		var el = select;
		if (!el.nodeName) {
			el = $(el);
			if (!el) return;
		}
		if (el.nodeName.toLowerCase() !== 'select') {
			throw new TypeError(el + " is not a DOMSelect element");
		}
		if (!isInDocument(el)) return;
		update(el.value);
	});
	el = $(select);
	if (el) el.addEvent('change', onChange);
	if (document.on) {
		document.on('pageload', onChange);
		document.on('db-update', onChange);
	}
	onChange();
	return onChange;
};
