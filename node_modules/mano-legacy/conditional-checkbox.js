'use strict';

var $ = require('./main');

require('./element#/class');
require('./element#/event');

module.exports = $.conditionalCheckbox = function (checkbox/*, options*/) {
	var options = Object(arguments[2]), current, savedState, forcedState = options.forcedState;
	if (forcedState === undefined) forcedState = true;
	$(checkbox).addEvent('click', function (e) {
		if (!current) return;
		$.preventDefault(e);
		$.stopPropagation(e);
	}, true);
	return function (value) {
		if (value) {
			if (!current) savedState = checkbox.checked;
			checkbox.checked = forcedState;
			checkbox.addClass('readonly');
			current = true;
		} else if (current) {
			checkbox.removeClass('readonly');
			checkbox.checked = savedState;
			current = false;
		}
	};
};
