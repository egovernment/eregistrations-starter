// Resolves app POST controllers

'use strict';

var assign  = require('es5-ext/object/assign')
  , copy    = require('es5-ext/object/copy')
  , forEach = require('es5-ext/object/for-each')

  , create = Object.create;

module.exports = function (base, extension/*, options*/) {
	var options = Object(arguments[2]), result = options.extendedOnly ? create(null) : copy(base);
	if (extension) {
		forEach(base, function (conf, key) {
			if (!extension[key]) return;
			if (conf === true) conf = result[key] = {};
			else conf = result[key] = copy(conf);
			assign(conf, extension[key]);
		});
		forEach(extension, function (conf, key) {
			if (result[key]) return;
			result[key] = conf;
		});
	}
	if (options.globalRoutes != null) assign(result, options.globalRoutes);
	return result;
};
