#!/usr/bin/env node

'use strict';

Error.stackTraceLimit = Infinity;

// Prevent EMFILE errors
require('fs2/descriptors-handler')();

var resolve           = require('path').resolve
  , genClientIndexes  = require('../scripts/generate-client-indexes')
  , genClientPrograms = require('../scripts/generate-client-programs')
  , genClientCss      = require('../scripts/generate-client-css')

  , program = require('commander').usage('[options] [path]')
	.option('--name <app-name>', "Specific app that should be setup")
	.parse(process.argv)
  , path, name = program.name;

path = program.args.length ? resolve(program.args[0]) : process.cwd();
if (name) console.log("Setup for:", name);

console.log("Generate client-side programs...");
genClientPrograms(path, program.name).done(function () {
	console.log("... generated client-side programs");
});

console.log("Generate client-side css...");
genClientCss(path, program.name).done(function () {
	console.log("... generated client-side css");
});

console.log("Generate client-side indexes...");
genClientIndexes(path, program.name).done(function () {
	console.log("... generated client-side indexes");
});
