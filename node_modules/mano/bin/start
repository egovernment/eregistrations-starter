#!/usr/bin/env node

'use strict';

Error.stackTraceLimit = Infinity;

// Prevent EMFILE errors
require('fs2/descriptors-handler')();

var resolve  = require('path').resolve
  , loadData = require('../scripts/load-data')
  , init     = require('../lib/server/init')
  , stdout   = process.stdout.write.bind(process.stdout)
  , program  = require('commander').usage('[options] [path]')
	.option('--quick', "Quick start (no generation)")
	.parse(process.argv)
  , path = program.args.length ? resolve(program.args[0]) : process.cwd();

require('../scripts/' + (program.quick ? 'quick-' : '') + 'setup')(path, null, stdout)(function () {
	return loadData(path, stdout)(function () { return init(path); });
}).done();
