#!/usr/bin/env node

'use strict';

Error.stackTraceLimit = Infinity;

var columns = require('cli-color/columns')
  , find    = require('../scripts/find-overriden-getters')

  , program = require('commander').usage('[options] [path]')
	.option('--ignores <ignores>', "Keys to ignore, provided as: foo,bar,lorem")
	.parse(process.argv)
  , ignores;

if (program.ignores) {
	ignores = program.ignores.split(',').map(Function.prototype.call.bind(String.prototype.trim));
}

find(process.cwd(), { log: process.stdout.write.bind(process.stdout), ignores: ignores })(
	function (data) {
		return data.mongo.close()(data.result);
	}
).done(function (data) {
	if (!data.length) {
		console.log("No records in question found");
		return;
	}
	console.log(columns(data.map(function (data) {
		return [
			data.object.object.constructor.__id__,
			data.object.__id__,
			data.descriptor.__id__
		];
	})));
});
