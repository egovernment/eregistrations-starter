// Generates detected apps list

'use strict';

var resolveTemplate = require('es6-template-strings')
  , path            = require('path')
  , readFile        = require('fs2/read-file')
  , writeFile       = require('fs2/write-file')
  , resolveApps     = require('../../server/utils/resolve-apps')

  , stringify = JSON.stringify
  , resolve = path.resolve
  , listTplPath = resolve(__dirname, 'list.js.tpl')

  , writeOpts = { intermediate: true };

module.exports = function (root) {
	return resolveApps(root)(function (apps) {
		return readFile(listTplPath)(function (template) {
			return writeFile(resolve(root, './server/apps/list.js'),
				resolveTemplate(template, { data: stringify(apps.sort(), null, '\t') }), writeOpts);
		});
	});
};
