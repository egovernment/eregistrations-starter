'use strict';

var customError = require('es5-ext/error/custom')
  , memoize     = require('memoizee/plain')
  , resolve     = require('path').resolve
  , findRoot    = require('next/module/find-package-root')

  , resolveRoot;

resolveRoot = memoize(function (path) {
	return findRoot(resolve(path, 'x'))(function (path) {
		if (path == null) {
			throw customError('Path is not within a package', 'INVALID_PACKAGE');
		}
		return path;
	});
});

module.exports = function (path) { return resolveRoot(resolve(String(path))); };
