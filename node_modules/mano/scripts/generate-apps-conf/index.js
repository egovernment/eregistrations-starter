// Generates map of applications configurations
// This module was initially generated by mano/scripts/generate-apps-conf

'use strict';

var resolveTemplate = require('es6-template-strings')
  , path            = require('path')
  , readFile        = require('fs2/read-file')
  , writeFile       = require('fs2/write-file')

  , stringify = JSON.stringify
  , relative = path.relative, resolve = path.resolve
  , confTplPath = resolve(__dirname, 'conf.js.tpl')

  , writeOpts = { intermediate: true };

module.exports = function (root, apps) {
	return readFile(confTplPath)(function (template) {
		var appsConf = '{\n\t' + apps.map(function (appPath) {
			var requirePath = relative('server/apps', appPath);
			if (requirePath[0] !== '.') requirePath = './' + requirePath;
			requirePath += '/mano';
			return stringify(appPath) + ': require(' + stringify(requirePath) + ')';
		}).join(',\n\t') + '\n}';
		return writeFile(resolve(root, './server/apps/conf.js'),
			resolveTemplate(template, { data: appsConf }), writeOpts);
	});
};
