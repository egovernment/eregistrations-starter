'use strict';

var value     = require('es5-ext/object/valid-value')
  , endsWith  = require('es5-ext/string/#/ends-with')
  , hash      = require('mano-auth/hash')
  , serialize = require('dbjs/_setup/serialize/value')
  , update    = require('./plain-dbjs-update');

module.exports = function (root, newPassword/*, options*/) {
	value(newPassword);
	return update(value(root), function (id, value) {
		if (!endsWith.call(id, '/password')) return;
		return hash.hash(newPassword)(serialize);
	}, arguments[2]);
};
