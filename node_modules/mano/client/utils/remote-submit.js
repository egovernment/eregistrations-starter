// Default remoteSubmit handler for client-side post router.
// See ../post-router.js and
// https://github.com/egovernment/eregistrations/blob/master/documentation/controllers.md

'use strict';

var forEach = require('es5-ext/object/for-each')
  , post    = require('../../lib/client/xhr-driver').post

  , isArray = Array.isArray;

module.exports = function (normalizedData, data) {
	var formData;
	if (this.form.enctype === 'multipart/form-data') {
		formData = new FormData();
		forEach(data, function (value, key) {
			if (isArray(value)) {
				value.forEach(function (value) {
					formData.append(key, value);
				});
			} else {
				formData.append(key, value);
			}
		});
	} else {
		formData = data;
	}
	return post(this.action.href, formData);
};
