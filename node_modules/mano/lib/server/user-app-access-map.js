'use strict';

var noApp           = require('deferred')('')
  , ComputedEmitter = require('eregistrations/server/utils/computed-emitter')
  , driver          = require('mano').dbDriver;

if (!driver) {
	// Prototype app needs such handling
	console.log("No db driver registered");
	console.log("Initialized dummy user app access map");

	module.exports = {
		get: function () { return noApp; },
		on: Function.prototype
	};
} else {
	module.exports = new ComputedEmitter(driver.getStorage('user'), 'appAccessId');
}
