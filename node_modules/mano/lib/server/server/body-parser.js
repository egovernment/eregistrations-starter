// Copied from Connect

'use strict';

/*!
	* Connect - bodyParser
	* Copyright(c) 2010 Sencha Inc.
	* Copyright(c) 2011 TJ Holowaychuk
	* MIT Licensed
*/

var normalizeOptions = require('es5-ext/object/normalize-options')
  , bodyParser       = require('body-parser')
  , multipart        = require('connect-multiparty')

  , urlencoded = bodyParser.urlencoded;

exports = module.exports = function (options) {
	var _urlencoded = urlencoded(normalizeOptions(options,
		{ extended: false, parameterLimit: 10000 }))
	  , _multipart = multipart(options);

	return function bodyParser(req, res, next) {
		if (req.method !== 'POST') return next();
		_urlencoded(req, res, function (err) {
			if (err) return next(err);
			_multipart(req, res, next);
		});
	};
};
