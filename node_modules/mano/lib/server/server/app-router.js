'use strict';

var debug = require('debug-ext')('client');

var resolveUser = function (user) {
	if (!user) return '[unauthenticated]';
	return user;
};

module.exports = function (req, res, next) {
	var name;
	if (this.some(function (item) {
			if (item.check(req, res)) {
				name = item.name;
				req.$forceLegacy = item.forceLegacy;
				req.$forceLegacyFullRender = item.forceLegacyFullRender;
				return true;
			}
			return false;
		})) {
		req.$appName = name || 'main';
	}
	debug("%s %s %s %s %s", req.$clientWithSessionId,
		req.method, req.url, resolveUser(req.$user), name);
	next();
};
