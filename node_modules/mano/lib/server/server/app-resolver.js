'use strict';

var callable = require('es5-ext/object/valid-callable')
  , debug    = require('debug-ext')('client');

module.exports = function (route) {
	callable(route);
	return function (req, res, next) {
		route(req);
		if (!req.$appName) {
			console.error("Unresolved application name for " + req.$clientId);
			res.statusCode = 500;
			res.end('Server error');
			return;
		}
		debug("%s %s %s %s %s", req.$clientId, req.method, req.url,
			req.$user || '[unauthenticated]', req.$appName);
		next();
	};
};
