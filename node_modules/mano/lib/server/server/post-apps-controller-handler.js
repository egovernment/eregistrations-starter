'use strict';

var deferred = require('deferred');

module.exports = function (routesMap) {
	return function (action, data, req, res, next) {
		var routes, env;
		routes = routesMap[req.$appName];
		if (routes) {
			env = { res: res, req: req, action: action };
			deferred(routes.call(env, data)).done(function (result) {
				if (result === false) next();
			});
			return;
		}
		next();
	};
};
