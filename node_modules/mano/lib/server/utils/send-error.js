'use strict';

var assign    = require('es5-ext/object/assign')
  , stringify = require('es5-ext/json/safe-stringify')
  , logError  = require('./log-error');

module.exports = function (error) {
	var message = logError(error), data;
	if (!error.statusCode) {
		this.statusCode = 500;
		this.end("Server error");
		return;
	}
	this.statusCode = error.statusCode;
	if (this.statusCode === 404) {
		this.end("Not found");
		return;
	}
	data = assign({}, error);
	data.message = message;
	this.writeHead(error.statusCode, { 'Content-Type': 'application/json; charset=utf-8' });
	this.end(stringify(data));
};
