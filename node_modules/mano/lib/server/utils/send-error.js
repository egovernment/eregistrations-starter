'use strict';

var forEach  = require('es5-ext/object/for-each')
  , logError = require('./log-error')

  , stringify = JSON.stringify;

module.exports = function (error) {
	var message = logError(error), data;
	if (!error.statusCode) {
		this.statusCode = 500;
		this.end("Server error");
		return;
	}
	this.statusCode = error.statusCode;
	data = {};
	forEach(error, function (value, key) {
		try { stringify(value); } catch (e) { return; }
		data[key] = value;
	});
	data.message = message;
	this.writeHead(error.statusCode, { 'Content-Type': 'application/json; charset=utf-8' });
	this.end(stringify(data));
};
