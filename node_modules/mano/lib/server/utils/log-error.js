'use strict';

var resolveErrorMessage = require('dbjs-error-message')
  , isDbjsError         = require('dbjs/is-dbjs-error');

var getErrorMessage = function (error) {
	if (!isDbjsError(error)) {
		return error.message;
	}
	return resolveErrorMessage(error);
};

module.exports = function (error) {
	var message = error.message;
	if (!error.statusCode) {
		console.error("Request error (unhandled)");
		console.error(error.stack || ("Error (not error instance):  " + error));
		if (!error.stack) console.error((new Error()).stack);
		return message;
	}
	if (error.errors) {
		message = error.errors.map(function (error) {
			return getErrorMessage(error);
		}).join('\n');
	} else {
		message = getErrorMessage(error);
	}
	console.log("Request error");
	console.log("Status code:", error.statusCode);
	console.log("Message:", message);
	console.log(error.stack);
	return message;
};
