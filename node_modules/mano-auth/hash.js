'use strict';

var deferred = require('deferred')
  , env      = require('mano').env

  , promisify = deferred.promisify
  , bcrypt, genSalt, hash;

try {
	bcrypt = require('bcrypt');
} catch (e) {
	if (!env.dev) throw e;
}

if (bcrypt) {
	genSalt = promisify(bcrypt.genSalt);
	hash = promisify(bcrypt.hash);

	exports.hash = function (str) { return hash(str, genSalt()); };
	exports.compare = promisify(bcrypt.compare);
} else {
	// If no bcrypt and dev environment
	// handle passwords in clear text form
	exports.hash = function (str) { return deferred(str); };
	exports.compare = function (a, b) { return deferred(a === b); };
}
