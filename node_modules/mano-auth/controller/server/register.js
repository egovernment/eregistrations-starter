'use strict';

var promisify  = require('deferred').promisify
  , bcrypt     = require('bcrypt')
  , dbjsCreate = require('mano/lib/utils/dbjs-form-create')

  , genSalt = promisify(bcrypt.genSalt), hash = promisify(bcrypt.hash);

exports.submit = function (data) {
	return hash(data['User#/password'], genSalt())(function (password) {
		data['User#/password'] = password;
		this.target = dbjsCreate(data);
	}.bind(this));
};
