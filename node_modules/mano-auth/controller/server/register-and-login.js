'use strict';

var Client     = require('mano/lib/server/client')
  , login      = require('mano-auth/server/authentication').login
  , register   = require('./register').submit;

exports.submit = function (data) {
	return register.apply(this, arguments)(function () {
		login(this.target.__id__, this.req, this.res);
		if (this.req.isHtmlServerRendered) return;
		return Client.get(this.req)(function (client) { return { inSync: client.isSync }; });
	}.bind(this));
};
