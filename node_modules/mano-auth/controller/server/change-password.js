'use strict';

var promisify = require('deferred').promisify
  , bcrypt    = require('bcrypt')
  , _         = require('mano').i18n.bind('authentication')
  , dbjsSave  = require('mano/lib/utils/dbjs-form-save')

  , genSalt = promisify(bcrypt.genSalt), hash = promisify(bcrypt.hash);

exports.submit = function (data) {
	return hash(data[this.propertyKey], genSalt())(function (password) {
		data[this.propertyKey] = password;
		dbjsSave(data);
		return { message: _("Password successfully changed") };
	}.bind(this));
};
