'use strict';

var Client   = require('mano/lib/server/client')
  , login    = require('../../server/authentication').login
  , register = require('./register').submit;

exports.submit = function (data) {
	if (!data['User#/roles']) data['User#/roles'] = ['user'];
	return register.apply(this, arguments)(function () {
		login(this.targetId, this.req, this.res);
		if (this.req.isHtmlServerRendered) return;
		return Client.get(this.req)(function (client) { return { inSync: client.isSync }; });
	}.bind(this));
};
