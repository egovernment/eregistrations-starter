'use strict';

var copyDeep           = require('es5-ext/object/copy-deep')
  , dbjsValidate       = require('mano/lib/utils/dbjs-form-validate')
  , passwordValidation = require('../utils/password-validation')
  , db                 = require('mano').db;

exports.validate = function (data) {
	var normalizedData = copyDeep(data);
	dbjsValidate(normalizedData, { changedOnly: true, partial: true });
	normalizedData.password = db.StringLine.validate(normalizedData.password);
	normalizedData['password-new'] = passwordValidation(normalizedData['password-new'],
		normalizedData['password-repeat']);
	delete normalizedData['password-repeat'];

	return normalizedData;
};
