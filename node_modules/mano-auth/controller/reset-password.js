'use strict';

var copyDeep    = require('es5-ext/object/copy-deep')
  , customError = require('es5-ext/error/custom')
  , isId        = require('time-uuid/is-time-uuid')
  , db          = require('mano').db
  , passwordValidation = require('../utils/password-validation');

exports.validate = function (data) {
	var normalizedData = copyDeep(data);
	normalizedData.password = passwordValidation(data.password, data['password-repeat']);
	delete normalizedData['password-repeat'];
	if (!isId(data['password-token'])) {
		throw customError("Cannot process request", "MALFORMED_ID",
			{ statusCode: 400 });
	}
	normalizedData.email = db.Email.validate(normalizedData.email);
	return normalizedData;
};
exports.redirectUrl = '/';
