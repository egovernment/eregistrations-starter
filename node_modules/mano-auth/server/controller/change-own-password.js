'use strict';

var customError = require('es5-ext/error/custom')
  , clientHash = require('../../utils/client-hash')
  , controller = require('./change-own-password-x').controller;

module.exports = function (data, env) {
	var user = env.$user;
	if (!user) throw customError("No user authenticated", 'NO_USER');
	data.password = clientHash(user.email, data.password);
	data['password-new'] = clientHash(user.email, data['password-new']);
	return controller(data, env);
};
