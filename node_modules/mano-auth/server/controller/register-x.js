'use strict';

var db           = require('mano').db
  , dbjsCreate   = require('mano/lib/utils/dbjs-form-create')
  , dbjsValidate = require('mano/lib/utils/dbjs-form-validate')
  , hash         = require('../../hash')

  , Sha256Hash = db.Sha256Hash;

exports.validate = function (data) {
	dbjsValidate(data, { assure: ['User#/email'], partial: true });
	Sha256Hash.validate(data['User#/password']);
};

exports.controller = function (data) {
	return hash.hash(data['User#/password'])(function (password) {
		data['User#/password'] = password;
		return dbjsCreate(data);
	});
};
