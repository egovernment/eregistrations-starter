'use strict';

var reflow     = require('dom-ext/html-document/#/reflow')
  , base       = require('./base');

module.exports = function (engine, document, location, content, require) {
	var view = base(engine, document.body, content, require)
	  , viewDoc = view.ownerDocument
	  , window = document.defaultView;

	// Make sure browser reflows window when content is changed
	viewDoc.on('load', function (view) {
		reflow.call(document);
		if (window && view.scroll && !location.hash) {
			window.scroll(Number(view.scroll.x) || 0, Number(view.scroll.y) || 0);
		}
	});

	// When current page is removed go up
	viewDoc.on('destroy', function (view, isCurrent) {
		if (isCurrent) location.goto('../');
	});

	view.domjs = engine;
	return view;
};
